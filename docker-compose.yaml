services:
  url-to-mealie:
    build: ./url-to-mealie
    ports:
      - "8999:6999"
    volumes:
      - /tmp:/tmp
      - recipe_logs:/var/log
    env_file: .env
    environment:
      - MEALIE_TOKEN=${MEALIE_API_KEY}
      - MEALIE_BASE_URL=${MEALIE_BASE_URL}
      - LOG_LEVEL=${LOG_LEVEL}
    restart: always
    networks:
      - mealie_default
    deploy:
      resources:
        limits:
          memory: 2.5G
        reservations:
          memory: 1.5G
    mem_swappiness: 80
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:6999/health"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 60s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  recipe_logs:
networks:
  mealie_default:
    external: true
